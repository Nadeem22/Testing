public boolean trackMasterNotPresent(String trackid) {
        String sql = "SELECT TRACK_ID FROM TRACK_MASTER WHERE TRACK_ID = ?";
        try {
            String result = jdbcTemplate.queryForObject(sql, new Object[]{trackid}, String.class);
            return result == null;
        } catch (Exception e) {
            e.printStackTrace();
            return true;
        }
    }
 public void updateAccompanyData(AccompanyData accompanyData) {
        if (accompanyData.getAccSt() == null && accompanyData.getAccId() == 1) {
            String lastCallStTimeSql = "select start_time from h2h_main where track_id = ?";
            String lastCallStTime = jdbcTemplate.queryForObject(
                    lastCallStTimeSql,
                    new Object[]{accompanyData.getTrackId()},
                    String.class
            );

            String lctd = "00:00:00";

            if (!StringUtils.isEmpty(lastCallStTime)) {
                String currCallStTimeSql = "select TIMEDIFF(STR_TO_DATE(?, '%d-%b-%Y %H:%i:%s'), ?)";
                lctd = jdbcTemplate.queryForObject(
                        currCallStTimeSql,
                        new Object[]{accompanyData.getGeoTimeStamp(), lastCallStTime},
                        String.class
                );
            }

            accompanyData.setLastCallDur(lctd);
        }
    }
@Configuration
@EnableTransactionManagement
public class TransactionConfig {

    @Autowired
    private DataSource dataSource;

    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource);
    }
}
 public boolean isGeoFenceReq(String trackId) {
        String sql = "select geo_fence_req from user_master where user_id = ?";
        try {
            Integer flag = jdbcTemplate.queryForObject(
                    sql,
                    new Object[]{trackId.substring(12)},
                    Integer.class
            );
            return (flag != null && flag != 0);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
public int getSupIdByStartCall(String trackId) {
        String sql = "select supervisor_id from h2h_main where track_id = ?";
        try {
            Integer supervisorId = jdbcTemplate.queryForObject(
                    sql,
                    new Object[]{trackId},
                    Integer.class
            );
            return (supervisorId != null) ? supervisorId : 0;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }
 public int getProperBId(String tId) {
        String brSql = "select brand from h2h_main where track_id = ?";
        try {
            Integer brId = jdbcTemplate.queryForObject(
                    brSql,
                    new Object[]{tId},
                    Integer.class
            );
            
            if (brId != null && brId > -1) {
                System.out.println(tId + ">>>>Brand Id is:::" + brId);
                return brId;
            } else {
                System.out.println(tId + ">>>>Brand Id is -1");
                return 18;
            }
        } catch (Exception e) {
            e.printStackTrace();
            return -1;
        }
    }
 public boolean accompanyDataNotPresent(AccompanyData fuldata) {
        String sql = "SELECT * FROM accompany_call WHERE TRACK_ID = ? and ACCOMPANY_ID = ? and BRAND_ID = ?";
        try {
            RowMapper<Object> rowMapper = (rs, rowNum) -> null; // We don't need to process the result, just check existence
            Object result = jdbcTemplate.queryForObject(
                    sql,
                    new Object[]{fuldata.getTrackId(), fuldata.getAccId(), fuldata.getBrandId()},
                    rowMapper
            );
            return result == null;
        } catch (Exception e) {
            e.printStackTrace();
            return true;
        }
    }
if ((accompanyData.getMachineType() != null && !accompanyData.getMachineType().isEmpty()) ||
    (accompanyData.getUserType() != null && !accompanyData.getUserType().isEmpty())) {

    String level = "insert into machine_userlevel_type (track_id, accompany_id, brand, level, type, load_type) values (?, ?, ?, ?, ?, ?)";

    String levelType = null;
    String type = null;
    String loadType = null;

    if (accompanyData.getMachineType() != null && !accompanyData.getMachineType().isEmpty()) {
        levelType = "Machine Type";
        type = accompanyData.getMachineType();
        if ("Fully Automatic Machine".equals(accompanyData.getMachineType())) {
            loadType = accompanyData.getWashingMachineType();
        } else {
            loadType = null;
        }
    } else if (accompanyData.getUserType() != null && !accompanyData.getUserType().isEmpty()) {
        levelType = "User Type";
        type = accompanyData.getUserType();
        loadType = null;
    }

    jdbcTemplate.update(level, accompanyData.getTrackId(), accompanyData.getAccId(),
            accompanyData.getBrandId(), levelType, type, loadType);
}
private String getBrandsForReport(String configName) {
    String sql = "select config_value from configdata where config_name = ?";
    
    try {
        return jdbcTemplate.queryForObject(sql, new Object[]{configName}, String.class);
    } catch (Exception e) {
        e.printStackTrace();
        return "";
    }
 if (brandArray != null) {
        for (String brand : brandArray) {
            if (brand.equals(configDataUtil.getDBConfigValues("Kissan_brandid"))) {
                // kissan ketchup or Domex user
                if (accompanyData.getKetchupUser() == 1) {
                    String sql = "insert into brand_type(track_id, accompany_id, brand_id,brand_type_id,brand_type_name) values (?,?,?,?,?)";
                    jdbcTemplate.update(sql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getBrandId(), accompanyData.getKetchupId(), accompanyData.getKetchup());
                    System.out.println("kissan user----" + sql);
                }
                // not a kissan ketchup or Domex user
                else if (accompanyData.getKetchupUser() == 2) {
                    String sql = "insert into brand_type(track_id, accompany_id, brand_id,brand_type_id,brand_type_name) values (?,?,?,?,?)";
                    jdbcTemplate.update(sql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getBrandId(), 0, null);
                    System.out.println("not a kisaan user----" + sql);
                }
            }
        }
    }
if (brandArray != null && !brands.equals("")) {
        for (String brand : brandArray) {
            if (brand.equals(configDataUtil.getDBConfigValues("Kissan_brandid"))) {
                // Kissan ketchup or Domex user
                if (accompanyData.getKetchupUser() == 1) {
                    String sql = "insert into brand_type(track_id, accompany_id, brand_id, brand_type_id, brand_type_name) values (?, ?, ?, ?, ?)";
                    jdbcTemplate.update(sql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getBrandId(), accompanyData.getKetchupId(), accompanyData.getKetchup());
                }
                // Not a Kissan ketchup or Domex user
                else if (accompanyData.getKetchupUser() == 2) {
                    String sql = "insert into brand_type(track_id, accompany_id, brand_id, brand_type_id, brand_type_name) values (?, ?, ?, ?, ?)";
                    jdbcTemplate.update(sql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getBrandId(), 0, null);
                }
            }
            if (brand.equals(configDataUtil.getDBConfigValues("Domex_brandid"))) {
                if (accompanyData.getBrandId() == Integer.parseInt(configDataUtil.getDBConfigValues("Domex_brandid"))) {
                    String sql = "insert into brand_type(track_id, accompany_id, brand_id, brand_type_id, brand_type_name) values (?, ?, ?, ?, ?)";
                    jdbcTemplate.update(sql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getBrandId(), accompanyData.getDomexId(), accompanyData.getDomex());
                }
            }
            if (brand.equals(configDataUtil.getDBConfigValues("CoreHorlicks_brandid"))) {
                if (accompanyData.getBrandId() == Integer.parseInt(configDataUtil.getDBConfigValues("CoreHorlicks_brandid"))) {
                    String sql = "insert into corehorlicks_age(track_id, accompany_id, brand_id, variant_sold, ageGroup) values (?, ?, ?, ?, ?)";
                    jdbcTemplate.update(sql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getBrandId(), accompanyData.getVariantSold(), accompanyData.getCoreHorlicksAge());
                }
            }
        }
    }
if (accompanyData.getAdhocVal() != null) {
        String adhocSql = "insert into promoter_on_call_adhoc(track_id, accompany_id, adhocVal) values (?, ?, ?)";
        jdbcTemplate.update(adhocSql, accompanyData.getTrackId(), accompanyData.getAccId(), accompanyData.getAdhocVal());
    }
 public String savePhotoData(ArrayList<PhotoData> photoDataList) {

        if (photoDataList != null) {

            String sql = "INSERT into track_fieldphoto_table(track_id, phototype_id, lattitude, longitude, cellLatitude, cellLongitude, "
                    + "imageDateTime, user_id, image_path, brand_id, accompany_id, loc_accu) "
                    + "Values(?,?,?,?,?,?,?,?,?,?,?,?)";

            try {

                jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {
                    @Override
                    public void setValues(PreparedStatement pstmt, int i) throws SQLException {
                        PhotoData photo = photoDataList.get(i);
                        pstmt.setString(1, photo.getTrackId());
                        pstmt.setInt(2, photo.getPhotoTypeId());
                        pstmt.setString(3, photo.getLatitude());
                        pstmt.setString(4, photo.getLongitude());
                        pstmt.setString(5, photo.getCellLatitude());
                        pstmt.setString(6, photo.getCellLongitude());
                        pstmt.setString(7, photo.getImageDateTime());
                        pstmt.setInt(8, photo.getUserId());
                        pstmt.setString(9, "images/" + photo.getTrackId() + "/" + photo.getImageName());
                        pstmt.setInt(10, photo.getBrandId());
                        pstmt.setInt(11, photo.getAccId());
                        pstmt.setString(12, photo.getLocationAccuracy());
                    }

                    @Override
                    public int getBatchSize() {
                        return photoDataList.size();
                    }
                });

                addImageQuality(photoDataList);

            } catch (Exception e) {
                e.printStackTrace();
                return "Failure";
            }

        } else {
            return "Failure";
        }

        return "success";
    }
 public String addImageQuality(ArrayList<PhotoData> photoDataList) {

        if (photoDataList != null) {

            String sql = "INSERT into h2h_schema.oncall_imageauto(track_id, acc_id, phototype_id, dark, blur) "
                    + "Values(?,?,?,?,?)";

            try {

                jdbcTemplate.batchUpdate(sql, new BatchPreparedStatementSetter() {
                    @Override
                    public void setValues(PreparedStatement pstmt, int i) throws SQLException {
                        PhotoData photo = photoDataList.get(i);
                        if ((photo.getPhotoTypeId() >= 700 && photo.getPhotoTypeId() <= 799)
                                || (photo.getPhotoTypeId() >= 1000 && photo.getPhotoTypeId() <= 1099)) {
                            pstmt.setString(1, photo.getTrackId());
                            pstmt.setInt(2, photo.getAccId());
                            pstmt.setInt(3, photo.getPhotoTypeId());
                            pstmt.setInt(4, photo.getDark());
                            pstmt.setInt(5, photo.getBlurry());
                        }
                    }

                    @Override
                    public int getBatchSize() {
                        return photoDataList.size();
                    }
                });

            } catch (Exception e) {
                e.printStackTrace();
                return "Failure";
            }

        } else {
            return "Failure";
        }

        return "success";
    }
